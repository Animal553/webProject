<!DOCTYPE html>
<html class="x-admin-sm">
    
    <head>
        <meta charset="UTF-8">
        <title>欢迎页面-X-admin2.2</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">
        <script src="./lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="./js/xadmin.js"></script>
    </head>
    
    <body>

        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            <button class="layui-btn" onclick="xadmin.open('添加商品','./goods-add.html',500,500)">
                                <i class="layui-icon"></i>添加</button></div>
                        <div class="layui-card-body ">
                            
							<!-- 
								生成数据表格的位置
							 -->
							<table id="demo" lay-filter="test"></table>
							
                        </div>
                    </div>
                </div>
            </div>
        </div>
		<script type="text/javascript">
			
			//加载模块
			layui.use(['table','layer','form','laydate'],function(){
				//获取对象
				var table = layui.table;
				var layer = layui.layer;
				var form = layui.form;
				var laydate = layui.laydate;
				//获取jquery对象
				var $ = layui.jquery;
				
				
				table.render({
					elem:"#demo",
					url:"http://localhost:8080/PassThree_LastWeekTest_war_exploded/getGoodsList",
					page:true,
					limit:1,
					limits:[1,2,4],
					request:{
						pageName:"pageNo",
						limitName:"pageSize"
					},
					parseData:function(d){
						var code_=0;
						var msg_="";
						var count_=0;
						var data_=[];
						if(d.code==200){
							code_=0;
							msg_=d.msg;
							data_=d.data.data;
							count_=d.data.count;
						}
						
						return {
							code:code_,
							msg:msg_,
							count:count_,
							data:data_
						}
					},
					cols:[[
						{field:"goodsId",title:"商品ID",width:"12%",sort:true},
						{field:"goodsName",title:"商品名称",width:"12%"},
						{field:"price",title:"商品价格",width:"12%",sort:true},
						{field:"categoryName",title:"商品类别",width:"12%",sort:true,templet:function(d){
							   return d.category.categoryName;
						}},
						{field:"createTime",title:"创建时间",width:"12%",sort:true,templet:function(d){
								 return d.createTime
						}},
						{title:"操作",width:"12%"},
						{
							title:"操作",
							width:"12%",
							templet: "#optionEdit"
						}
					]]
				});
				
				
				//工具条绑定
				/* 
					obj: 入参里面保存的是当前行数据,以及点击当前行的事件信息
				 */
				table.on('tool(test)',function(obj){
					//获取当前行触发的事件
					var e = obj.event;
					if(e=='del'){ //删除员工
						layer.confirm("确认删除吗?",function(index){
							
							layer.close(index);//关闭当前的弹出层
							
							//调用AJAX删除后台数据
							$.getJSON("http://localhost:8080/PassThree_LastWeekTest_war_exploded/deleteGoods",{goodsId:obj.data.goodsId},function(m){
								if(m.code==200){
									obj.del();
								}else{
									layer.msg(m.msg);
								}
							})
						});
					}else if(e=='update'){ //弹出更新页面
						//弹出更新页面
						layer.open({
							type:2,
							title:"更新商品",
							area:['500px','500px'],
							content:"goods-update.html",
							success:function(layero, index){
								//获取当前层的dom对象
								var body = layer.getChildFrame("body",index);
								//给body对象中的input控件以及select控件赋值
								body.find("#goodsId").val(obj.data.goodsId);
								body.find("#goodsName").val(obj.data.goodsName);
								body.find("#price").val(obj.data.price);
								body.find("#categoryName").val(obj.data.category.categoryName);
								body.find("#createTime").val(obj.data.createTime);
								body.find("#categoryId1").val(obj.data.category.categoryId);
							}
						});
					}
				});
				
			});
			
		</script>
    </body>
	<script type="text/jscript" id="optionEdit">
		<button type="button" class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">删除</button>
		<button type="button" class="layui-btn layui-btn-xs layui-btn-normal" lay-event="update">更新</button>
	</script>
</html>