# 机试作业题

利用Redis常用命令，完成奥运 奖牌排行榜

http://match.2008.sina.com.cn/bj2008/all_medal.php

| 国家 | 金牌 | 银牌 | 铜牌 | 总数 |
| ---- | ---- | ---- | ---- | ---- |
| 中国 | 12   | 9    | 8    |      |
| 美国 | 12   | 8    | 8    |      |
| 德国 | 10   | 7    | 6    |      |



# Redis晨考题

1. ## String类型常用命令（5个）、应用场景(2个)

   ```
   创建/赋值 set  key  value
   创建会过期的 key setex  key  time  value
   创建/自增key  incrby  key
   创建/自减key decr  key
   获取key   get key
   ```

   1、**因String是二进制安全的，所以你完全可以把一个图片文件的内容作为字符串来存储**

   2、**计数器（常规key-value缓存应用。常规计数: 微博数, 粉丝数)**

   

2. ## Hash类型常用命令（5个）、应用场景(2个)

   ```
   创建hash类型的key  hset key value
   获取所有哈希表中的字段  HKEYS KEY  
   获取哈希表中字段的数量  HLEN KEY 
   删除一个或多个HASH表字段   HDEL KEY field1[field2] 
   为哈希表 key 中的指定字段的整数值加上增量 increment  HINCRBY key field increment 
   
   ```

   1、**存对象**

   2、**用户注册/修改信息**

1. ## List类型常用命令（5个）、应用场景（2个）

   	LPUSH key value1 [value2]  :将一个或多个值插入到列表头部(从左侧添加)
   	RPUSH key value1 [value2]  :在列表中添加一个或多个值(从右侧添加)
   	LINDEX key index   :通过索引获取列表中的元素
   	LRANGE key start stop  :获取列表指定范围内的元素
   	LPOP key  移出并获取列表的第一个元素(从左侧删除)
   	RPOP key  移除列表的最后一个元素，返回值为移除的元素(从右侧删除)
   **项目常应用于：1、对数据量大的集合数据删减 2、任务队列** 

2. ## Set类型常用命令(5个)、应用场景（2个）

   ```
   SADD key member1 [member2] :向集合添加一个或多个成员 
   SMEMBERS key  :返回集合中的所有成员 
   SISMEMBER key member  :判断 member 元素是否是集合 key 的成员
   SREM key member1 [member2] :移除集合中一个或多个成员
   SPOP key [count]  :移除并返回集合中的一个随机元素
   ```

   1，**抽奖活动**

   2，**判断用户是否存在**

3. ## ZSet类型常用命令(5个)、应用场景（2个）

   ````
   ZADD key score1 member1 [score2 member2]  :向有序集合添加一个或多个成员，或者更新已存在成员的分数  
   ZCOUNT key min max :计算在有序集合中指定区间分数的成员数
   ZRANK key member :返回有序集合中指定成员的索引
   ZRANGE key start stop [WITHSCORES] :通过索引区间返回有序集合成指定区间内的成员(低到高)
   ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT] :通过分数返回有序集合指定区间内的成员
   ````

   1,**排行榜**

   2,**阅读量**

4. ## Redis持久化RDB和AOF区别

   RDB：是创建一个rdb的文件，当redis出发快照机制的时候，将数据存进rdb文件中。但是在服务器宕机的时候，在没有快照的那段时间的数据将会丢失。

   AOF：是将redis的写操作进行存储在aof文件中，虽然这个操作不会使数据丢失，但是aof文件中的写操作大多都是没用的，每次启动的时候都会进行一些没有意义的操作。

5. ## Redis缓存和数据库一致性（工作中是如何将Redis和数据库数据进行同步的）

   1实时同步，在缓存中查询，当查不到的时候就去DB中查询，再将其加入到缓存中

   2异步队列，使用kafka/rabbitMQ消息队列将数据消化

   3使用阿里的同步工具canal

   4采用udf自定义函数的方式

6. ## 缓存穿透是什么，解决方案、原因

   **缓存穿透是指查询一个一定不存在的数据，由于缓存是不命中时需要从数据库查询，查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到数据库去查询，造成缓存穿透。**

   持久层查询不到就缓存空结果，查询时先判断缓存中是否exists(key) ,如果有直接返回空，没有则查询后返回，
   注意insert时需清除查询的key，否则即便DB中有值也查询不到(当然也可以设置空缓存的过期时间）

   ​		1、不管数据实际上存不存在，我们都把这个键存到缓存中（有效期设置的短一些，比如一分钟到三分钟），然后值设置为一个特定值，业务中如果获取到的结果是这个特定值，则报错返回。

   ​		2、是使用 redis 的布隆过滤器（Bloom Filter），将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被 这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。

   

7. ## 缓存雪崩是什么，解决方案、

   **雪崩：缓存大量失效的时候，引发大量查询数据库。**

     用锁/分布式锁或者队列串行访问
   	缓存失效时间均匀分布

8. ## 热点KEY处理，（缓存击穿）

   **热点key:某个key访问非常频繁，当key失效的时候有大量线程来构建缓存，导致负载增加，系统崩溃。**

   1 使用锁，单机用synchronized,lock等，分布式用分布式锁。

   2 缓存过期时间不设置，而是设置在key对应的value里。如果检测到存的时间超过过期时间则异步更新缓存。

   3在value设置一个比过期时间t0小的过期时间值t1，当t1过期的时候，延长t1并做更新缓存操作。

   4设置标签缓存，标签缓存设置过期时间，标签缓存过期后，需异步地更新实际缓存 